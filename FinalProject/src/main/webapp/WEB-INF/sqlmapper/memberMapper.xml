<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
 PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
 "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
 
 <mapper namespace="com.alj.dream.member.dao.MemberDao">
 
 
 	<insert id="insertMember" parameterType="com.alj.dream.member.domain.RegisterInfo" useGeneratedKeys="true" keyProperty="m_idx">
 		insert into member(m_email, m_password, m_nm, m_adyn, m_photo) values(#{m_email}, #{m_password},#{m_nm},#{m_adyn},#{m_photo})
 	</insert>
 	
 	<select id="selectByEmail" resultType="String">
 		select m_email from member where m_email = #{arg0}
 	</select>
 	
 	<select id="getMemberList" resultType="com.alj.dream.member.domain.MemberInfo">
 	
 	SELECT m_idx, m_email, m_nm, m_photo, m_regdate, m_quitdate, m_blacklist,(select count(*) FROM 
																				member join report
																				on member.m_idx=report.m_reported
																				) as reportCount
	FROM member
	
	limit #{arg0}, #{arg1}
	
 	
 	</select>
 	
 	<select id="getTotalNumOfMember" resultType="String">
 	
 		SELECT count(*) from member
 	</select>
 	
 	
 	
 	<select id="getMemberInfo" resultType="com.alj.dream.member.domain.MemberInfo">
 		SELECT 
				m_idx, 
    			m_email, 
    			m_nm,
    			m_photo,  
    			m_regdate,
    			m_quitdate,
    			m_blacklist,
    			(select count(*) FROM 
				member join report
				on member.m_idx=report.m_reported
				WHERE m_idx=#{arg0}
				) as reportCount
			FROM member
			WHERE m_idx=#{arg0}
 	
 	</select>
 	
 	<!-- member의 idx로 멤버 정보 반환 -->
 	<select id="selectByIdx" resultType="com.alj.dream.member.domain.MyInfo">
		SELECT m_email, m_nm, m_photo, date_format(m_regdate,'%Y년 %m월 %d일') as m_regdate from dream.member where m_idx=#{m_idx}
	</select>
	
	<!-- member 의 정보 수정 -->
	<update id="editMember">
	
		UPDATE member
		SET
		<if test="m_nm!=null">
			m_nm=#{m_nm}
		</if>
		<if test="photo!=null">
			m_photo=#{m_photo}
		</if>
		<if test="m_password!=null">
			m_password=#{m_password}
		</if>
		
		WHERE m_idx=#{m_idx}
		
	
	</update>
	
 	
 	
 	
 	
 	
 	
 </mapper>
 
 