<?xml version="1.0" encoding="UTF-8"?>

<!DOCTYPE mapper
 PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
 "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.alj.dream.review.dao.ReviewDao">

	<!-- 해당 유저의 평균 별점을 반환하는 쿼리 -->
	<!-- 소수점 1째 자리까지만 반환 truncate(평균별점, 1째자리)-->
	<select id="getStars" resultType="com.alj.dream.review.domain.StarsInfo">
		SELECT count(*) as count, sum(stars) as sum FROM 
		dream.member mem JOIN post JOIN dream.match mat JOIN review rev
		ON 
		mem.m_idx=post.m_idx AND mat.match_idx=rev.match_idx AND post.post_idx=mat.post_idx
		WHERE
		mat.mentor_idx=#{arg0}
	</select>
	
	<select id="getTotalReview" resultType="Integer">
		SELECT count(*) FROM 
		dream.member mem JOIN post JOIN dream.match mat JOIN review rev
		ON 
		mem.m_idx=post.m_idx and mat.match_idx=rev.match_idx and post.post_idx=mat.post_idx
		WHERE mat.mentor_idx=${arg0};
	</select>



</mapper>
 